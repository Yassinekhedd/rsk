{% comment %}
Simple header de secours : logo, menu, recherche, panier.
Compatible OS 2.0. Pas dâ€™overlay fancy ; recherche classique /search.
{% endcomment %}

<header class="emergency-header" role="banner">
  <div class="emh-container">
    <div class="emh-left">
      <a href="{{ routes.root_url }}" class="emh-logo" aria-label="{{ shop.name }}">
        {% if section.settings.logo != blank %}
          <img src="{{ section.settings.logo | image_url: width: 220 }}" alt="{{ shop.name | escape }}" loading="eager" fetchpriority="high">
        {% else %}
          <span class="emh-logo-text">{{ shop.name }}</span>
        {% endif %}
      </a>
    </div>

    {% if section.settings.menu != blank %}
      <nav class="emh-nav" role="navigation" aria-label="Main">
        <ul>
          {% for link in section.settings.menu.links %}
            <li>
              <a href="{{ link.url }}" {% if link.current %}aria-current="page"{% endif %}>{{ link.title }}</a>
              {% if link.links.size > 0 %}
                <ul class="emh-subnav">
                  {% for sublink in link.links %}
                    <li><a href="{{ sublink.url }}">{{ sublink.title }}</a></li>
                  {% endfor %}
                </ul>
              {% endif %}
            </li>
          {% endfor %}
        </ul>
      </nav>
    {% endif %}

    <div class="emh-right">
      {% if section.settings.show_search %}
        <form class="emh-search" action="{{ routes.search_url }}" method="get" role="search" aria-label="{{ 'general.search.search' | t }}">
          <input type="search" name="q" placeholder="{{ 'general.search.search' | t }}" value="{{ search.terms | escape }}" aria-label="{{ 'general.search.search' | t }}">
          <button type="submit">{{ 'general.search.submit' | t | default: 'Search' }}</button>
        </form>
      {% endif %}

      {% if section.settings.show_cart %}
        <a class="emh-cart" href="{{ routes.cart_url }}" aria-label="{{ 'sections.cart.title' | t | default: 'Cart' }}">
          <span class="emh-cart-icon">ðŸ›’</span>
          <span class="emh-cart-count" aria-live="polite">{{ cart.item_count }}</span>
        </a>
      {% endif %}
    </div>
  </div>
</header>

<style>
  .emergency-header { position: sticky; top: 0; z-index: 50; background: #fff; border-bottom: 1px solid rgba(0,0,0,.08); }
  .emh-container { max-width: 1200px; margin: 0 auto; padding: 10px 16px; display: grid; grid-template-columns: 1fr auto 1fr; align-items: center; gap: 12px; }
  .emh-left { justify-self: start; }
  .emh-right { justify-self: end; display: inline-flex; align-items: center; gap: 12px; }
  .emh-logo img { height: 36px; width: auto; }
  .emh-logo-text { font-weight: 700; font-size: 18px; }
  .emh-nav ul { list-style: none; margin: 0; padding: 0; display: inline-flex; gap: 18px; }
  .emh-nav a { text-decoration: none; }
  .emh-subnav { display: none; position: absolute; background: #fff; border: 1px solid rgba(0,0,0,.08); padding: 8px; }
  .emh-nav li { position: relative; }
  .emh-nav li:hover > .emh-subnav { display: block; }
  .emh-search { display: inline-flex; align-items: center; gap: 6px; }
  .emh-search input { min-width: 220px; padding: 6px 8px; border: 1px solid rgba(0,0,0,.2); }
  .emh-search button { padding: 6px 10px; border: 1px solid rgba(0,0,0,.2); background: #f8f8f8; cursor: pointer; }
  .emh-cart { display: inline-flex; align-items: center; gap: 6px; text-decoration: none; }
  .emh-cart-count { min-width: 20px; text-align: center; border-radius: 10px; padding: 2px 6px; background: #eee; font-size: 12px; }
  @media (max-width: 900px) {
    .emh-container { grid-template-columns: 1fr auto auto; }
    .emh-nav { display: none; } /* simple : on masque le menu en mobile pour aller vite */
    .emh-search input { min-width: 150px; }
  }
</style>

{% schema %}
{
  "name": "Emergency Header",
  "settings": [
    { "type": "image_picker", "id": "logo", "label": "Logo" },
    { "type": "link_list", "id": "menu", "label": "Menu principal" },
    { "type": "checkbox", "id": "show_search", "label": "Afficher la recherche", "default": true },
    { "type": "checkbox", "id": "show_cart", "label": "Afficher le panier", "default": true }
  ],
  "presets": [{ "name": "Emergency Header" }]
}
{% endschema %}
